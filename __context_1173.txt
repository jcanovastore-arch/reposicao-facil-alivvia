                                "Baixar comparação (.csv)",
                                data=cmp_df.to_csv(index=False).encode("utf-8"),
                                file_name=f"Comparacao_ALIVVIA_JCA_{alvo}.csv",
                                mime="text/csv",
                                key="dl_cmp_duas_contas"
                            )
                    except Exception as e:
                        st.error(f"Falha na comparação: {e}")
        else:
            st.info("Clique Gerar Compra para calcular e então aplicar filtros.")
# ================== TAB 3: Alocação de Compra ==================
with tab3:
    st.subheader("Distribuir quantidade entre empresas — proporcional às vendas (FULL + Shopee)")
    if st.session_state.catalogo_df is None or st.session_state.kits_df is None:
        st.info("Carregue o Padrão (KITS/CAT) no sidebar.")
    else:
        CATALOGO = st.session_state.catalogo_df
